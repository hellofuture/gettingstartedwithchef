<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Managing multiple nodes - Getting started with Chef</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Learn how to configure, manage and provision cloud servers with Chef by following practical examples with real world applications.">
    <meta name="author" content="Andy Gale for Hello Future Ltd">

    <!-- CSS -->
    <link href="assets/cerulean/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/base.css?v=3" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
<!--     <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="..`icon.png"> -->
  </head>

  <body>

    <div id="wrap">
      <div id="hellofutureinfo">
        <div class="container"><p>The authors of this online book <a href="http://hellofutu.re">Hello Future</a> offer cloud automation and Chef training and consultancy.<br/>Say <a href="mailto:hello@hellofutu.re">hello@hellofutu.re</a> for more information or <a href="https://twitter.com/hellofutur3">follow us on Twitter</a>.</p></div>
      </div>

       <div class="container">
          <div class="page-header">
            <ul id="gswc-chapter-switcher" class="nav nav-pills">
              <li class="active dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">Chapters <b class="caret"></b></a>
                <ul class="pull-right dropdown-menu">
                  <li><a href="index.html">Home</a></li>
                  <li><a href="first-steps-with-chef.html">First steps with Chef</a></li>
                  <li><a href="introducing-chef-server.html">Introducing Chef Server</a></li>
                  <li><a href="more-than-one-website.html">More than one website</a></li>
                  <li class="active"><a href="managing-multiple-nodes.html">Managing multiple nodes</a></li>
                </ul>
              </li>
            </ul>
            <h1>Getting started with Chef</h1>
            <div>By Andy Gale</div>
          </div>

          <ul class="pager">
            <li class="previous"><a href="more-than-one-website.html">&larr; More than one website</a></li>
          </ul>

          <h2>4. Managing multiple nodes</h2>

          <div class="alert alert-success"><strong>Heads up!</strong> To follow along with the examples in this chapter you'll need the Hosted Chef account and set up from the last two  chapters.</div>

          <p>In this chapter we'll take our example WordPress hosting set up to an enterprise level by using Chef to configure multiple redundant nodes.</p>

          <h3>Too much traffic?</h3>

          <p>Having too much traffic for a single web server to handle is a nice problem to have! As our imaginary WordPress website empire grows and we get more traffic, we will need to increase our capacity beyond our little web server. We have two options: vertical or horizontal scaling.</p>

          <p>Vertical scaling is adding more power to the machine that runs our website or application. It is often the easiest option as code only written to run on a single machine can be moved easily to a bigger machine, especially if you already have automated server setup with Chef. However as your traffic increases so does your hardware or cloud hosting bill. If you have a quad core server with 16 GB of RAM and your traffic increases, you will now need an eight core machine with 32GB.</p>

          <p>At enterprise level you should probably have a server on standby for redundancy in case of hardware or software failure anyway so you may as well use it to serve some traffic. This is called horizontal scaling.</p>

          <p>Horizontal scaling is adding more servers and sharing the load between them. It can also have the advantage of adding redundancy. If we have two web servers handling traffic and one breaks our websites will remain online. If we can separate various parts of our website or application into different services we can have even more redundancy.</p>

          <p>Our <strong>phpapp</strong> default recipe already supports vertical scaling as we can use it to build a new server with more memory but we need to make some changes to it before we can scale horizontally. Let's split up our recipe in two. We'll have a recipe that sets up the MySQL server, database and acesss details and another to set up our web server and site code.</p>

          <h3>Two recipes</h3>

          <p>We'll create a recipe called <strong>mysql_server</strong> inside the <strong>phpapp</strong> cookbook.</p>

          <p>On your workstation, load <em>cookbooks/phpapp/recipes/mysql_server.rb</em> in your text editor.</p>

          <pre class="editor">#
# Cookbook Name:: phpapp
# Recipe:: mysql_server
#
# Copyright 2013, YOUR_COMPANY_NAME
#
# All rights reserved - Do Not Redistribute
#

include_recipe &quot;mysql::server&quot;
include_recipe &quot;mysql::ruby&quot;

sites = data_bag(&quot;wp-sites&quot;)
 
sites.each do |site|
  opts = data_bag_item(&quot;wp-sites&quot;, site)

  mysql_database opts[&quot;database&quot;] do
    connection ({:host =&gt; 'localhost', :username =&gt; 'root', :password =&gt; node['mysql']['server_root_password']})
    action :create
  end

  mysql_database_user opts[&quot;db_username&quot;] do
    connection ({:host =&gt; 'localhost', :username =&gt; 'root', :password =&gt; node['mysql']['server_root_password']})
    password opts[&quot;db_password&quot;]
    database_name opts[&quot;database&quot;]
    privileges [:select,:update,:insert,:create,:delete]
    action :grant
  end
end</pre>
  
        <p>Add the code above. You'll notice we've included just the parts that we need to setup a MySQL server.</p>

        <p>Now save the file.</p>

        <p>We'll now make changes to the default recipe so it just installs the web part of the site.</p>

        <p>Now load <em>cookbooks/phpapp/recipes/default.rb</em> in your text editor.</p>


        <ul class="pager">
          <li class="previous"><a href="more-than-one-website.html">&larr; More than one website</a></li>
        </ul>
        
        <div id="push"></div>
    </div>

    <div id="footer">
      <div class="container">
        <p class="muted credit">&copy; <a href="http://hellofutu.re">Hello Future Ltd</a>. Registered in England and Wales. Company No: 08378526<br />
        Created with <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a> and <a href="http://bootswatch.com/cerulean/" target="_blank">Bootswatch Cerulean.</a></p>
      </div>
    </div>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-38853378-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <script type="text/javascript" src="assets/js/lib/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/gswc.js"></script>
  </body>
</html>

